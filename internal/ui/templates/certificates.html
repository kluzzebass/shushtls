{{define "title"}}ShushTLS — Certificates{{end}}
{{define "content"}}
<h1>Certificates</h1>
<p>Issue TLS certificates for your services (NAS, web apps, etc.) and download cert + key. Each certificate is signed by your root CA. Browsers will accept it on any device where you've installed the root (see <a href="/trust">Install CA</a> page). The <strong>service</strong> cert is the one used for this ShushTLS web interface; you can change it with &ldquo;Use as service&rdquo; on any other cert.</p>

{{if eq .State "uninitialized"}}
<article>
  <p>No certificates yet. <a href="/">Initialize ShushTLS first</a>.</p>
</article>

{{else}}

{{if .Certs}}
<figure>
  <table>
    <thead>
      <tr>
        <th scope="col">Primary SAN</th>
        <th scope="col">DNS Names</th>
        <th scope="col">Valid Until</th>
        <th scope="col">Role</th>
        <th scope="col">Download</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      {{range .Certs}}
      <tr>
        <td><code>{{.PrimarySAN}}</code></td>
        <td>{{range .DNSNames}}{{.}} {{end}}</td>
        <td>{{.NotAfter}}</td>
        <td>{{if .IsService}}<mark>service</mark>{{else}}issued{{end}}</td>
        <td>
          <a href="/api/certificates/{{.PrimarySAN}}">cert</a> &middot;
          <a href="/api/certificates/{{.PrimarySAN}}?type=key">key</a> &middot;
          <a href="/api/certificates/{{.PrimarySAN}}?type=zip">zip</a>
        </td>
        <td>
          {{if not .IsService}}
          <button class="outline secondary set-service-btn" data-san="{{.PrimarySAN}}"
                  style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Use as service</button>
          {{end}}
        </td>
      </tr>
      {{end}}
    </tbody>
  </table>
</figure>
{{else}}
<p>No certificates issued yet.</p>
{{end}}

<article>
  <header><strong>Issue a new certificate</strong></header>

  <form id="issue-form">
    <label for="dns_names">
      DNS Names
      <input type="text" id="dns_names" name="dns_names"
             placeholder="*.local, nas.local"
             aria-label="Comma-separated DNS names" required>
      <small>Comma-separated. Use *.domain for wildcards.</small>
    </label>

    <details>
      <summary>Subject (optional)</summary>
      <p>Pre-filled from defaults in <a href="/settings">Settings</a>. Change any field to override for this certificate only. CN is always the first DNS name.</p>
      <label for="issue-organization">Organization (O)<input type="text" id="issue-organization" name="organization" value="{{.LeafSubject.Organization}}" placeholder="(none)"></label>
      <label for="issue-organizational-unit">Organizational unit (OU)<input type="text" id="issue-organizational-unit" name="organizational_unit" value="{{.LeafSubject.OrganizationalUnit}}" placeholder="(none)"></label>
      <label for="issue-country">Country (C)
      <select id="issue-country" name="country">
        <option value="">(none)</option>
        {{range .CountryCodes}}<option value="{{.Code}}" {{if eq .Code $.LeafSubject.Country}}selected{{end}}>{{.Code}} — {{.Name}}</option>{{end}}
      </select>
    </label>
      <label for="issue-locality">Locality (L)<input type="text" id="issue-locality" name="locality" value="{{.LeafSubject.Locality}}" placeholder="(none)"></label>
      <label for="issue-province">State / Province (ST)<input type="text" id="issue-province" name="province" value="{{.LeafSubject.Province}}" placeholder="(none)"></label>
    </details>

    <button type="submit" id="issue-btn">Issue Certificate</button>
  </form>

  <div id="issue-result" role="alert" hidden></div>

  <noscript>
    <hr>
    <p>JavaScript is disabled. Use curl to issue certificates:</p>
    <pre><code>curl -X POST {{.Scheme}}://{{.Host}}/api/certificates \
  -H "Content-Type: application/json" \
  -d '{"dns_names": ["*.example.com"]}'</code></pre>
  </noscript>
</article>

{{end}}
{{end}}
