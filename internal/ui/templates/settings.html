{{define "title"}}ShushTLS — Settings{{end}}
{{define "content"}}
<h1>Settings</h1>
<p>Optional HTTP Basic Auth. When enabled, you need a username and password to initialize, issue certificates, or change the service cert. Downloading the root CA and listing certificates stay open so install scripts and new devices can get the root without credentials.</p>

{{if eq .State "uninitialized"}}
<article>
  <p>ShushTLS must be initialized before settings can be configured. <a href="/">Run Setup first</a>.</p>
</article>
{{else}}

<h2>Authentication</h2>

{{if .AuthEnabled}}
<article>
  <p>
    <span class="state-badge" data-state="ready">Enabled</span>
    HTTP Basic Auth is active. Protected endpoints require credentials.
  </p>

  <h3>Update Credentials</h3>
  <form id="auth-update-form">
    <label for="auth-username">
      Username
      <input type="text" id="auth-username" name="username" required autocomplete="username">
    </label>
    <label for="auth-password">
      Password
      <input type="password" id="auth-password" name="password" required autocomplete="new-password">
    </label>
    <button type="submit" id="auth-update-btn">Update Credentials</button>
  </form>

  <hr>

  <h3>Disable Authentication</h3>
  <p>Remove protection from API endpoints. You can re-enable it at any time.</p>
  <button type="button" id="auth-disable-btn" class="outline secondary">Disable Authentication</button>

  <div id="auth-result" hidden></div>
</article>

{{else}}
<article>
  <p>
    <span class="state-badge" data-state="uninitialized">Disabled</span>
    Authentication is not enabled. All API endpoints are open.
  </p>

  <h3>Enable Authentication</h3>
  <p>
    Protect sensitive API endpoints with HTTP Basic Auth. Certificate
    listings and downloads remain open so install scripts work without credentials.
  </p>
  <form id="auth-enable-form">
    <label for="auth-username">
      Username
      <input type="text" id="auth-username" name="username" required autocomplete="username">
    </label>
    <label for="auth-password">
      Password
      <input type="password" id="auth-password" name="password" required autocomplete="new-password">
    </label>
    <button type="submit" id="auth-enable-btn">Enable Authentication</button>
  </form>

  <div id="auth-result" hidden></div>
</article>
{{end}}

<h2>Certificate subject defaults</h2>
<article>
  <p>These fields are used for the <strong>O</strong> (Organization), <strong>OU</strong> (Organizational Unit), <strong>C</strong> (Country), <strong>L</strong> (Locality), and <strong>ST</strong> (State/Province) in issued leaf certificates. The common name (CN) is always the primary hostname. Leave blank to use defaults (Organization only).</p>
  <form id="leaf-subject-form">
    <label for="leaf-organization">Organization (O)<input type="text" id="leaf-organization" name="organization" value="{{.LeafSubject.Organization}}" placeholder="ShushTLS"></label>
    <label for="leaf-organizational-unit">Organizational unit (OU)<input type="text" id="leaf-organizational-unit" name="organizational_unit" value="{{.LeafSubject.OrganizationalUnit}}" placeholder="(optional)"></label>
    <label for="leaf-country">Country (C)
      <select id="leaf-country" name="country">
        <option value="">(none)</option>
        {{range .CountryCodes}}<option value="{{.Code}}" {{if eq .Code $.LeafSubject.Country}}selected{{end}}>{{.Code}} — {{.Name}}</option>{{end}}
      </select>
    </label>
    <label for="leaf-locality">Locality (L)<input type="text" id="leaf-locality" name="locality" value="{{.LeafSubject.Locality}}" placeholder="(optional)"></label>
    <label for="leaf-province">State / Province (ST)<input type="text" id="leaf-province" name="province" value="{{.LeafSubject.Province}}" placeholder="(optional)"></label>
    <button type="submit" id="leaf-subject-btn">Save subject defaults</button>
  </form>
  <div id="leaf-subject-result" hidden></div>
</article>

<noscript>
  <article>
    <p><strong>Without JavaScript:</strong></p>
    <pre><code># Get current leaf subject defaults:
curl -sS {{.BaseURL}}/api/leaf-subject

# Update leaf subject defaults:
curl -X PUT {{.BaseURL}}/api/leaf-subject \
  -H "Content-Type: application/json" \
  -d '{"organization": "My Org", "organizational_unit": "IT", "country": "US"}'

# Enable auth:
curl -X POST {{.BaseURL}}/api/auth \
  -H "Content-Type: application/json" \
  -d '{"enabled": true, "username": "admin", "password": "your-password"}'

# Disable auth (requires current credentials):
curl -X POST -u admin:your-password {{.BaseURL}}/api/auth \
  -H "Content-Type: application/json" \
  -d '{"enabled": false}'</code></pre>
  </article>
</noscript>

{{end}}
{{end}}
